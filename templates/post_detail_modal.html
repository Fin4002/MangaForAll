{# templates/post_detail_modal.html #}
<button class="modal-close" data-close aria-label="Close">×</button>

<div class="pd-modal">
  <header class="pd-head">
    {% if post.user_id %}
      <img class="avatar small"
           src="{{ url_for('user_avatar', uid=post.user_id) }}?v={{ session.get('avatar_ver', 0) }}"
           alt="{{ post.author or 'User' }}">
    {% else %}
      <div class="avatar small">{{ (post.author or 'A')[:1] }}</div>
    {% endif %}
    <div>
      <div class="pd-name">{{ post.author or 'Anonymous' }}</div>
      <div class="pd-sub">Post #{{ post.post_id }}</div>
    </div>
  </header>

  {% if post.image %}
    <figure class="pd-media">
      <img src="{{ url_for('post_image_blob', post_id=post.post_id) }}" alt="Post image">
    </figure>
  {% endif %}

  {% if post.content %}
    <p class="pd-text">{{ post.content }}</p>
  {% endif %}

  <section class="comments" style="border-top:1px solid color-mix(in oklab, var(--text), transparent 92%); padding-top:12px">
    <h4 class="comments-title">Comments</h4>

    {% if comments and comments|length %}
      <ul class="pd-comment-list">
        {% for c in comments %}
          <li class="pd-comment">
            {% if c.user_id %}
              <img class="avatar tiny"
                   src="{{ url_for('user_avatar', uid=c.user_id) }}?v={{ session.get('avatar_ver', 0) }}"
                   alt="{{ c.username or 'User' }}">
            {% else %}
              <div class="avatar tiny">{{ (c.username or 'A')[:1] }}</div>
            {% endif %}
            <div class="pd-bubble">
              <div class="pd-who">{{ c.username or 'Anonymous' }}</div>
              <p>{{ c.content }}</p>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="card-sub">No comments yet.</p>
    {% endif %}

    {% if user %}
      <form method="POST"
            action="{{ url_for('post_detail', post_id=post.post_id) }}?partial=1"
            class="pd-form"
            data-ajax>
        <textarea name="content" class="input" rows="3" placeholder="Write a comment…" required></textarea>
        <button class="btn" type="submit">Comment</button>
      </form>
    {% else %}
      <p class="card-sub">Please <a href="{{ url_for('login') }}">log in</a> to comment.</p>
    {% endif %}
  </section>
</div>
