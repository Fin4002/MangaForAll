{% extends 'base.html' %}
{% block title %}Forum Â· MangaForAll{% endblock %}
{% block content %}
  <h1 class="page-title">Forum</h1>

  <!-- Top 10 Contributors -->
  <div class="top-contributors">
    <h2>Top 10 Contributors</h2>
    <!-- <p>{{ top_contributors | safe }}</p> -->
    <ul>
      {% for contributor in top_contributors %}
        <li><b>{{ contributor.author }}</b> - {{ contributor.total_contributions }} contributions</li>
      {% endfor %}
    </ul>
  </div>

  <a href="{{ url_for('new_post') }}" class="btn">New Post</a>

  {% if posts %}
    <div class="forum-list">
      {% for post in posts %}
        <div class="card forum-post">
          <div class="card-body">
            <h3 class="card-title">{{ post.title }}</h3>
            <p class="card-text">{{ post.content }}</p>
            <small>By {{ post.author }}</small>
            {% if post.image %}
              <img src="{{ url_for('post_image_blob', post_id=post.post_id) }}" alt="Post image" style="max-width:300px;">
            {% endif %}
          </div>

          <div class="card-body">
            <h4 class="mb-2">Comments</h4>
            {% set c_list = comments_by_post.get(post.post_id, []) %}
            {% if c_list %}
              <ul class="space-y-2">
                {% for c in c_list %}
                  <li><b>{{ c.username or 'Anonymous' }}</b>: {{ c.content }}</li>
                {% endfor %}
              </ul>
            {% else %}
              <p>No comments yet.</p>
            {% endif %}

            {% if user %}
              <form method="POST" action="{{ url_for('add_comment', post_id=post.post_id) }}" class="mt-3">
                <textarea name="content" class="input" rows="2" required></textarea><br>
                <button type="submit" class="btn">Add Comment</button>
              </form>
            {% else %}
              <p class="mt-3"><a href="{{ url_for('login') }}">Login</a> to comment</p>
            {% endif %}
          </div>
        </div>
      {% endfor %}
    </div>
  {% else %}
    <p>No posts yet. Be the first to post!</p>
  {% endif %}
{% endblock %}




