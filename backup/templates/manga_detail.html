{% extends 'base.html' %}
{% block title %}{{ manga.Title }} Â· MangaForAll{% endblock %}

{% block content %}
  {# Resolve a safe cover URL for the hero + card #}
  {% set hero_cover = cover_url
        or (url_for('static', filename=manga.CoverPath) if manga.CoverPath else None)
        or url_for('static', filename='placeholder.jpg') %}

  <!-- HERO header with blurred background -->
  <div class="hero" style="--hero:url('{{ hero_cover }}')">
    <div class="hero-inner">
      <div class="cover-hero" style="background-image:url('{{ hero_cover }}')"></div>
      <div>
        <h1 class="hero-title">{{ manga.Title }}</h1>
        <div class="hero-meta">
          {% set st = (manga.publication_status or 'unknown')|lower %}
          {% if st in ['ongoing','active','published'] %}
            <span class="badge ok">{{ manga.publication_status }}</span>
          {% elif st in ['hiatus','paused'] %}
            <span class="badge warn">{{ manga.publication_status }}</span>
          {% else %}
            <span class="badge danger">{{ manga.publication_status or 'unknown' }}</span>
          {% endif %}
          <span class="card-sub">By {{ manga.Author_name or 'Unknown' }}</span>
        </div>
        <div class="hero-actions">
          {% if folder and chapters and chapters|length %}
            <a class="btn" href="{{ url_for('reader', folder=folder, chapter=chapters[0], back=request.path) }}">Start Reading</a>
          {% else %}
            <a class="btn outline" href="#chapters">Chapters</a>
          {% endif %}
        </div>
      </div>
    </div>
  </div>

  <div class="space"></div>

  <!-- Synopsis -->
  <div class="card fade-in">
  {% if manga.synopsis %}
    <div class="card-header centered">
      <div class="card-title">Synopsis</div>
    </div>
    <p class="synopsis">{{ manga.synopsis or 'No synopsis available.' }}</p>
    <div class="space"></div>
  {% endif %}
</div>


  <!-- Chapters -->
<div id="chapters" class="card fade-in">
  <div class="card-header">
    <div class="card-title">Chapters</div>
    {% if chapters %}
      <span class="badge ok">{{ chapters|length }} found</span>
    {% endif %}
  </div>

  {% if folder and chapters and chapters|length %}
    <table class="table" id="chapters-table" data-chunk="30">
      <tbody>
        {% for ch in chapters %}
          <tr class="chapter-row"
              data-idx="{{ loop.index0 }}"
              onclick="window.location='{{ url_for('reader', folder=folder, chapter=ch, back=request.path) }}'">
            <td>
              <div class="row" style="gap:10px; align-items:center">
                <span class="badge warn">#{{ loop.index }}</span>
                <strong>{{ ch }}</strong>
              </div>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    <!-- Controls -->
    <div class="row" id="chapter-controls" style="justify-content:center; gap:10px; padding:12px 0;">
      <button class="btn" data-more>Show more</button>
      <button class="btn outline hidden" data-collapse>Collapse</button>
    </div>
  {% else %}
    <div class="alert warn center">Chapters not available yet for this title.</div>
  {% endif %}
</div>
{% endblock %}
